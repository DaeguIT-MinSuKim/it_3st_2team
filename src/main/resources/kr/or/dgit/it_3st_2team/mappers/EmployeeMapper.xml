<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.dgit.it_3st_2team.dao.EmployeeDao">
	<!-- yyj -->
	<resultMap id="employeeResult" type="Employee">
		<id property="empNo" column="emp_no" />
		<result property="empName" column="emp_name" />
		<result property="joinDate" column="join_date" />
		<result property="addr" column="addr" />
		<result property="id" column="id" />
		<result property="password" column="epassword" />
		<result property="eOff" column="eoff"/>
		<result property="eTf" column="e_tf" />
	</resultMap>

	<resultMap type="Employee" id="empNoResult">
		<id property="empNo" column="emp_no" />
	</resultMap>

	<!-- select empno -->
	<!-- yyj -->
	<sql id="selectEmpNoSql">
		select emp_no from employee
	</sql>
	<sql id="whereCusnoSql">
		<where>
			<if test="empName != null">
				emp_name = #{empName}
			</if>
		</where>
	</sql>

	<select id="selectEmpNo" resultType="int">
		<include refid="selectEmpNoSql" />
		<include refid="whereCusnoSql" />
	</select>
	<!-- yyj -->
	<resultMap type="Employee" id="empNoNameResult">
		<id property="empNo" column="emp_no" />
		<result property="empName" column="emp_name" />
	</resultMap>

	<resultMap type="Employee" id="empNameResult">
		<result property="empName" column="emp_name" />
	</resultMap>

	<resultMap type="Employee" id="EmployeeAddTitle" extends="employeeResult">
		<association property="title"
			resultMap="kr.or.dgit.it_3st_2team.dao.TitleDao.TitleResult" />
	</resultMap>

	<sql id="JoinEmpTitleNameSql">
		select e.title_no , e.emp_no, e.emp_name,t.title_name
		from
		employee e join
		title t on e.title_no=t.title_no
	</sql>

	<sql id="whereeTfSql">
		<where>
			<if test="eTf != null">
				e_tf = #{eTf}
			</if>
		</where>
	</sql>

	<select id="selectTitleName" resultMap="EmployeeAddTitle">
		<include refid="JoinEmpTitleNameSql"></include>
		<include refid="whereeTfSql"></include>
	</select>
	<resultMap id="employeeResultAddTitle" type="Employee"
		extends="employeeResult">
		<association property="titleNo"
			resultMap="kr.or.dgit.it_3st_2team.dao.TitleDao.TitleResult" />
	</resultMap>

	<select id="selectEmpByLoginId" parameterType="Employee"
		resultMap="employeeResultAddTitle">
		select id,password from employee where id=#{id}
	</select>

	<select id="selectAllEmployee" resultType="Employee">
		select emp_no,
		emp_name from employee;
	</select>

	<!--bjh -->

	<sql id="EmployeeTfSql">
		<where>
			<if test="eTf == 0">
				e_tf = "퇴사"
			</if>
		</where>
	</sql>

	<select id="selecteNowEmplyoee" parameterType="Employee"
		resultMap="employeeResultAddTitle">
		select e.emp_no ,
		e.emp_name,e.join_date,e.addr,id,e.epassword,t.title_no,e.eoff,e_tf
		from employee e join
		Title t
		on e.title_no=t.title_no
	</select>


	<!--bjh -->
	<sql id="updateNowEmplyoeeSql">
		update Employee 
		set
		epassword=#{password},e.title_no=#{e_tf
		from
		employee e join
		Title t on e.title_no=t.title_no
		where e.emp_no=#{empNo}
	</sql>
	<update id="updateNowEmplyoee" parameterType="Employee">
		<include refid="updateNowEmplyoeeSql"></include>
	</update>

</mapper>
